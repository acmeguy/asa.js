!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("promise-polyfill/src/polyfill"),require("whatwg-fetch"),require("whatwg-url")):"function"==typeof define&&define.amd?define(["promise-polyfill/src/polyfill","whatwg-fetch","whatwg-url"],e):e()}(0,function(){"use strict";if(String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var n=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>n.length)&&(e=n.length),e-=t.length;var r=n.indexOf(t,e);return-1!==r&&r===e}),window.localStorage)try{localStorage.localStorage=1,delete localStorage.localStorage}catch(r){var t=function(){var t={};return{setItem:function(e,n){t[e]=n},getItem:function(e){return t[e]},removeItem:function(e){delete t[e]}}},e=t(),n=t();Object.defineProperties(window,{localStorage:{get:function(){return e}},sessionStorage:{get:function(){return n}}})}var r,o={sessionStorage:window.sessionStorage,location:window.location},i={location:document.location,referrer:document.referrer},s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},u=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},f=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};!function(t){t[t.utm_campaign=0]="utm_campaign",t[t.utm_medium=1]="utm_medium",t[t.utm_source=2]="utm_source",t[t.utm_content=3]="utm_content",t[t.utm_term=4]="utm_term",t[t.length=5]="length"}(r||(r={})),function(t){t.forEach=Array.prototype.forEach,t.map=Array.prototype.map}(r||(r={}));var p=function t(e,n,r,o,i){s(this,t),this.campaign=e,this.medium=n,this.source=r,this.content=o,this.term=i},l=function(){var t=i.referrer&&new URL(i.referrer),e=i.location&&new URL(i.location),n=r.map(function(n){return t&&t.searchParams.get(n)||e&&e.searchParams.get(n)||o.sessionStorage.getItem("__as."+n)||void 0});return n.some(function(t){return!!t})&&new(Function.prototype.bind.apply(p,[null].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(n))))},h="__as.partner_id",d="__as.partner_sid",m=function(){var t,e,n,s=i.referrer&&new URL(i.referrer).host,a=i.location&&new URL(i.location).host;s&&s!==a&&(t=o.location&&new URL(o.location.href),e=t.searchParams.get(h),n=t.searchParams.get(d),r.forEach(function(e){var n=decodeURIComponent(t.searchParams.get(e)||"");n?o.sessionStorage.setItem("__as."+e,n):o.sessionStorage.removeItem("__as."+e)}),e?o.sessionStorage.setItem(h,e):o.sessionStorage.removeItem(h),n?o.sessionStorage.setItem(d,n):o.sessionStorage.removeItem(d))},g=function(){return o.sessionStorage.getItem(h)},v=function(){return o.sessionStorage.getItem(d)};console||(window.console={}),console.log||(window.console.log=function(){});var y=new(function(){function t(){s(this,t),this._logger=t.none}return a(t,[{key:"mode",value:function(e){this._logger=e?t.console:t.none}},{key:"log",value:function(){this._logger.apply(this,arguments)}},{key:"force",value:function(){t.console.apply(t,arguments)}}],[{key:"none",value:function(){}},{key:"console",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){for(var t,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];(t=console).log.apply(t,["js"].concat(n))})}]),t}()),b=function(){return Math.round(Math.random()*Date.now())},w=0;function _(t){return function(t){for(var e=w?"0123456789ABCDEF":"0123456789abcdef",n="",r=void 0,o=0;o<t.length;o++)r=t.charCodeAt(o),n+=e.charAt(r>>>4&15)+e.charAt(15&r);return n}(function(t){return function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>24-n%32&255);return e}(function(t,e){t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;for(var n=Array(80),r=1732584193,o=-271733879,i=-1732584194,s=271733878,a=-1009589776,c=0;c<t.length;c+=16){for(var u=r,f=o,p=i,l=s,h=a,d=0;d<80;d++){n[d]=d<16?t[c+d]:I(n[d-3]^n[d-8]^n[d-14]^n[d-16],1);var m=E(E(I(r,5),S(d,o,i,s)),E(E(a,n[d]),O(d)));a=s,s=i,i=I(o,30),o=r,r=m}r=E(r,u),o=E(o,f),i=E(i,p),s=E(s,l),a=E(a,h)}return Array(r,o,i,s,a)}(function(t){for(var e=Array(t.length>>2),n=0;n<e.length;n++)e[n]=0;for(var r=0;r<8*t.length;r+=8)e[r>>5]|=(255&t.charCodeAt(r/8))<<24-r%32;return e}(t),8*t.length))}(function(t){var e="",n=-1,r=void 0,o=void 0;for(;++n<t.length;)r=t.charCodeAt(n),o=n+1<t.length?t.charCodeAt(n+1):0,55296<=r&&r<=56319&&56320<=o&&o<=57343&&(r=65536+((1023&r)<<10)+(1023&o),n++),r<=127?e+=String.fromCharCode(r):r<=2047?e+=String.fromCharCode(192|r>>>6&31,128|63&r):r<=65535?e+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|63&r):r<=2097151&&(e+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|63&r));return e}(t)))}function S(t,e,n,r){return t<20?e&n|~e&r:t<40?e^n^r:t<60?e&n|e&r|n&r:e^n^r}function O(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function E(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function I(t,e){return t<<e|t>>>32-e}var k={getItem:function(t){return t&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(t,e,n,r,o,i){if(!t||/^(?:expires|max\-age|path|domain|secure)$/i.test(t))return!1;var s="";if(n)switch(n.constructor){case Number:s=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:s="; expires="+n;break;case Date:s="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+s+(o?"; domain="+o:"")+(r?"; path="+r:"")+(i?"; secure":""),!0},removeItem:function(t,e,n){return!!this.hasItem(t)&&(document.cookie=encodeURIComponent(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(e?"; path="+e:""),!0)},hasItem:function(t){return!(!t||/^(?:expires|max\-age|path|domain|secure)$/i.test(t))&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var t=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),e=t.length,n=0;n<e;n++)t[n]=decodeURIComponent(t[n]);return t}},A=function(){var t=P()+"."+_(b());return k.setItem("__as_user",t,1/0,"/"),t},j=function(){var t=k.getItem("__as_user");return(!t||t.length>70||t.length<40)&&(t=A()),t},P=function(){return _(o.location.host)},x={get:function(t){try{return k.getItem(t)}catch(e){throw new Error("Error while trying to get item from session cookie:"+t)}},set:function(t,e){try{return k.setItem(t,e,1/0,"/")}catch(n){throw new Error('Error while trying to set item to session cookie: "'+t+'" <- '+e)}},remove:function(t){try{k.removeItem(t)}catch(e){throw new Error('Error while trying to remove item from session cookie: "'+t)}}},C={hasItem:x.get,getItem:x.get,setItem:x.set,removeItem:x.remove},R=function(){function t(){s(this,t)}return a(t,[{key:"hasSession",value:function(){try{return!!(L().t>Date.now())}catch(t){return!1}}},{key:"createSession",value:function(t){var e,n;C.setItem("__asa_session",JSON.stringify(Object.assign({},t,{campaign:l(),referrer:(e=i.referrer&&new URL(i.referrer).host,n=i.location&&new URL(i.location.toString()).host,e&&n&&e!==n?e:null),id:P()+"."+_(j()+"."+b()),t:Date.now()+18e5})))}},{key:"destroySession",value:function(){return C.removeItem("__asa_session")}},{key:"getSession",value:function(){return JSON.parse(C.getItem("__asa_session"))}},{key:"refreshSession",value:function(t){var e=l(),n=Object.assign({},this.getSession(),t,e&&{campaign:e},{t:Date.now()+18e5});C.setItem("__asa_session",JSON.stringify(n))}}]),t}(),U=new R,T=function(t,e,n){U=new(function(r){function o(){return s(this,o),f(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return u(o,R),a(o,[{key:"hasSession",value:function(){return t()}},{key:"getSession",value:function(){return e()}},{key:"createSession",value:function(t){n(t)}}]),o}())},L=function(){return U.getSession()},F=function(){return M(Array.prototype.reduce.call(document.querySelectorAll('head > meta[property^="og:"]'),function(t,e){return Object.assign({},t,c({},e.getAttribute("property"),e.getAttribute("content")))},{keywords:document.querySelector('head > meta[name="keywords"]')&&document.querySelector('head > meta[name="keywords"]').getAttribute("content")}))},M=function(t,e){return t},D=function(t){M=function(e,n){try{return t(e,n)}catch(t){return e}}},$=function(t){var e="string"==typeof t?document.querySelectorAll(t):t,n=[].map.call(e,function(t){return M(function t(e){if(e.hasAttribute("itemscope")){var n=Array.prototype.reduce.call(e.children,function(e,n){return Object.assign({},e,c({},n.getAttribute("itemprop"),t(n)))},{});return e.getAttribute("itemtype")&&(n={type:e.getAttribute("itemtype"),properties:n}),n}return e.hasAttribute("itemprop")?e.getAttribute("content")||e.innerText||e.src:{__items:[].map.call(e.children,t)}}(t),t)}).filter(function(t){return t});return n.length>1?{__items:n}:n.pop()};var q,J,N="1.1.77",H=function(t){return!(!t||!(t instanceof HTMLElement||t[0]instanceof HTMLElement||"string"==typeof t))&&t},G=function(){function t(){s(this,t);var e=L(),n=e.id,r=e.referrer,i=e.campaign,a=g(),c=v();this.origin=o.location.origin,this.occurred=new Date,i&&(this.campaign=i),this.user={did:j(),sid:n},this.page={url:o.location.href},r&&(this.page.referrer=r),Y().id&&(this.tenant=Y().id),a&&(this.partner_id=a),c&&(this.partner_sid=c),this.v=N}return a(t,[{key:"toJSON",value:function(){return JSON.parse(JSON.stringify(Object.assign({},this)))}},{key:Symbol.toPrimitive,value:function(){return this.type}}]),t}();!function(t){t.Email="Email"}(q||(q={})),function(t){!function(e){!function(t){var e=function(t){function e(){s(this,e);var t=f(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.type="as.web.order.reviewed",t}return u(e,G),e}();t.reviewed=e}(e.order||(e.order={}));!function(t){!function(t){var e=function(t){function e(){s(this,e);var t=f(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.type="as.web.customer.account.provided",t}return u(e,G),e}();t.provided=e}(t.account||(t.account={}))}(e.customer||(e.customer={}));!function(t){var e=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{products:null};s(this,e);var n=t.products,r=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&(n[r[o]]=t[r[o]])}return n}(t,["products"]),o=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(n&&(o.products=n),H(r)){var i=$(r);i&&(arguments.length<=1?void 0:arguments[1])&&(i=Object.assign({},i,arguments.length<=1?void 0:arguments[1])),i&&(o.meta=i)}else o.meta=Object.assign({},r,F());return o}return u(e,G),e}();t.product=e;!function(t){var n=function(t){function n(){s(this,n);var t=f(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments));return t.type="as.web.product.availability.checked",t}return u(n,e),n}();t.checked=n}(t.availability||(t.availability={}));var n=function(t){function n(){s(this,n);var t=f(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments));return t.type="as.web.product.carted",t}return u(n,e),n}();t.carted=n;var r=function(t){function n(){s(this,n);var t=f(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments));return t.type="as.web.product.searched",t}return u(n,e),n}();t.searched=r;!function(t){var n=function(t){function n(){s(this,n);var t=f(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments));return t.type="as.web.product.shipping.selected",t}return u(n,e),n}();t.selected=n}(t.shipping||(t.shipping={}));var o=function(t){function n(){s(this,n);var t=f(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments));return t.type="as.web.product.viewed",t}return u(n,e),n}();t.viewed=o}(e.product||(e.product={}));!function(t){var e=function(t){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{orders:null}).orders;s(this,e);var n=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.type="as.web.payment.completed",t&&(n.orders=t),n}return u(e,G),e}();t.completed=e}(e.payment||(e.payment={}));!function(e){var n=function(t){function e(){s(this,e);var t=f(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.location=new URL(document.location.toString()).href,t.title=document.title.toString(),t.session=L(),t}return u(e,t),e}(t.web.product.product);e.session=n;var r=function(t){function e(){s(this,e);var t=f(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.type="as.web.session.started",t}return u(e,n),e}();e.started=r;var o=function(t){function e(){s(this,e);var t=f(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.type="as.web.session.resumed",t}return u(e,n),e}();e.resumed=o}(e.session||(e.session={}))}(t.web||(t.web={}))}(J||(J={}));var W={"as.web.session.started":J.web.session.started,"as.web.session.resumed":J.web.session.resumed,"as.web.customer.account.provided":J.web.customer.account.provided,"as.web.order.reviewed":J.web.order.reviewed,"as.web.product.availability.checked":J.web.product.availability.checked,"as.web.product.carted":J.web.product.carted,"as.web.product.searched":J.web.product.searched,"as.web.product.shipping.selected":J.web.product.shipping.selected,"as.web.product.viewed":J.web.product.viewed,"as.web.payment.completed":J.web.payment.completed},z=function(t,e){return("0"+Math.abs(e)).slice(-t)},B=function(t,e){return fetch(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"text/plain; charset=UTF-8"}})},K=function(t){return e={ev:t,t:(n=new Date,r=-n.getTimezoneOffset(),o=new Date(n),o.setMinutes(n.getMinutes()+r),o.toISOString().slice(0,-1)+(~Math.sign(r)?"+":"-")+z(2,r/60)+":"+z(2,r%60))},B("//inbox.activitystream.com/asa",e);var e,n,r,o},Q=function(t,e){return B("//inbox.activitystream.com/asa/error",{err:t,context:e,v:N})},V=new(function(){function t(){var e=this;s(this,t),this._dispatchEvent=K,this._dispatchError=Q,this.pendingSubmission=[],this.done=!0,this.submitEvent=function(t){return e._dispatchEvent(t)},this.submitError=function(t,n){return e._dispatchError(t,n)}}return a(t,[{key:"batchEvent",value:function(t){this.pendingSubmission.push(t)}},{key:"batchOn",value:function(){var t=this;this.batchIntervalHandler=setInterval(function(){try{if(t.pendingSubmission.length>0&&t.done){var e=Math.min(t.pendingSubmission.length,10),n=t.pendingSubmission.slice(0,e);t.done=!1,n.forEach(function(e){return K(e).then(function(){return t.pendingSubmission.splice(0,n.length)}).catch(y.log)})}}catch(t){y.log("exception submitting",t)}},400)}},{key:"batchOff",value:function(){this.batchIntervalHandler?clearInterval(this.batchIntervalHandler):y.log("cannot batch off, it is not on")}},{key:"override",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._dispatchEvent,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._dispatchError;this._dispatchError=e,this._dispatchEvent=t}},{key:"reset",value:function(){this._dispatchError=Q,this._dispatchEvent=K}}]),t}());function X(t){for(var e={"create.custom.session":T,"set.tenant.id":this.constructor.setTenant,"set.connected.partners":function(t,e){var n=e,i=function(e){var i=e.target,s=i.href;if(s){var a=new URL(s);~n.indexOf(a.host)&&(a.searchParams.set(h,t),a.searchParams.set(d,L().id),r.forEach(function(t){var e=o.sessionStorage.getItem("__as."+t);e&&a.searchParams.set(t,e)}),i.href=a.href)}};document.addEventListener("mousedown",i),document.addEventListener("keyup",i),document.addEventListener("touchstart",i)}.bind(null,this.constructor.getTenant()),"set.logger.mode":y.mode,"set.metadata.transformer":D},n=arguments.length,i=Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];try{if(!W[t])return e[t]&&e[t].apply(e,i),X.bind(this);V.submitEvent(new(Function.prototype.bind.apply(W[t],[null].concat(i))))}catch(t){y.force("inbox exception:",t),V.submitError(t,{location:"processing inbox message",arguments:[event].concat(i)})}return X.bind(this)}X.prototype=new(function(){function t(){s(this,t)}return a(t,null,[{key:"setTenant",value:function(t){var e;U.hasSession()?(!function(t){U.refreshSession(t)}(),V.submitEvent(new J.web.session.resumed),y.log("session resumed")):(y.log("no session, starting a new one"),U.createSession(e),V.submitEvent(new J.web.session.started)),this.id=t}},{key:"getTenant",value:function(){return this.id}}]),t}());var Y=window.asa=new X;!function(){try{var t=window.asa&&window.asa.q||[];window.asa=Y,m(),t.forEach(function(t){return Y.apply(null,t)})}catch(t){y.force("exception during init: ",t),V.submitError(t,{location:"boot script"})}}()});
