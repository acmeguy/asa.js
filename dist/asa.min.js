!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("whatwg-fetch")):"function"==typeof define&&define.amd?define(["whatwg-fetch"],t):t()}(0,function(){"use strict";var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t=setTimeout;function n(){}function s(e){if(!(this instanceof s))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function o(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,s._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var s;try{s=n(e._value)}catch(e){return void i(t.promise,e)}r(t.promise,s)}else(1===e._state?r:i)(t.promise,e._value)})):e._deferreds.push(t)}function r(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof s)return e._state=3,e._value=t,void a(e);if("function"==typeof n)return void c((o=n,r=t,function(){o.apply(r,arguments)}),e)}e._state=1,e._value=t,a(e)}catch(t){i(e,t)}var o,r}function i(e,t){e._state=2,e._value=t,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&s._immediateFn(function(){e._handled||s._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)o(e,e._deferreds[t]);e._deferreds=null}function c(e,t){var n=!1;try{e(function(e){n||(n=!0,r(t,e))},function(e){n||(n=!0,i(t,e))})}catch(e){if(n)return;n=!0,i(t,e)}}s.prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){var s=new this.constructor(n);return o(this,new function(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}(e,t,s)),s},s.prototype.finally=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){return t.reject(n)})})},s.all=function(e){return new s(function(t,n){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var s=Array.prototype.slice.call(e);if(0===s.length)return t([]);var o=s.length;function r(e,i){try{if(i&&("object"==typeof i||"function"==typeof i)){var a=i.then;if("function"==typeof a)return void a.call(i,function(t){r(e,t)},n)}s[e]=i,0==--o&&t(s)}catch(e){n(e)}}for(var i=0;i<s.length;i++)r(i,s[i])})},s.resolve=function(e){return e&&"object"==typeof e&&e.constructor===s?e:new s(function(t){t(e)})},s.reject=function(e){return new s(function(t,n){n(e)})},s.race=function(e){return new s(function(t,n){for(var s=0,o=e.length;s<o;s++)e[s].then(t,n)})},s._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},s._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var u=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw new Error("unable to locate global object")}();if(u.Promise||(u.Promise=s),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){const n=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>n.length)&&(t=n.length),t-=e.length;const s=n.indexOf(e,t);return-1!==s&&s===t}),window.localStorage)try{localStorage.localStorage=1,delete localStorage.localStorage}catch(e){const t=()=>{const e={};return{setItem(t,n){e[t]=n},getItem:t=>e[t],removeItem(t){delete e[t]}}},n=t(),s=t();Object.defineProperties(window,{localStorage:{get:()=>n},sessionStorage:{get:()=>s}});console.error(e),console.error("Safari in private mode can not save settings, and some features may not work","Warning!")}const d={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/};var p=new class{constructor(e={}){this.options=d,this.options=Object.assign({},this.options,e)}parseURI(e){const t=this.options.parser.exec(e),n={};let s=14;for(;s--;)n[this.options.key[s]]=t[s]||"";return n[this.options.q.name]={},n[this.options.key[12]].replace(this.options.q.parser,(e,t,s)=>{t&&(n[this.options.q.name][t]=s)}),n}};const h={sessionStorage:window.sessionStorage,location:window.location,set asa(e){window.asa=e},get asa(){return window.asa}},l={location:document.location,referrer:document.referrer},{sessionStorage:m}=h;const f=["utm_medium","utm_source","utm_campaign","utm_content","utm_term"];var g=()=>{const e=l.referrer&&new URL(l.referrer),t=l.location&&new URL(l.location),n=f.reduce((n,s)=>{const o=e&&e.searchParams.get(s)||t&&t.searchParams.get(s)||m.getItem(`__as.${s}`);return o?Object.assign({},n,{[s]:o}):n},null);return n&&new class{constructor(e,t,n,s,o){this.campaign=e,this.medium=t,this.source=n,this.content=s,this.term=o}}(n.utm_campaign,n.utm_medium,n.utm_source,n.utm_content,n.utm_term)};const y=()=>{p.parseURI(l.referrer).authority!==p.parseURI(h.location.origin).authority&&(()=>{const e=p.parseURI(h.location.href),t=decodeURIComponent(e.queryKey.__asa||"").split("|");let n,s;t&&(n=t[0],s=t[1]),f.forEach(t=>{const n=decodeURIComponent(e.queryKey[t]||"");n?h.sessionStorage.setItem(`__as.${t}`,n):h.sessionStorage.removeItem(`__as.${t}`)}),n?h.sessionStorage.setItem("__as.PARTNER_ID",n):h.sessionStorage.removeItem("__as.PARTNER_ID"),s?h.sessionStorage.setItem("__as.PARTNER_SID",s):h.sessionStorage.removeItem("__as.PARTNER_SID")})()},w=()=>h.sessionStorage.getItem("__as.PARTNER_ID"),_=()=>h.sessionStorage.getItem("__as.PARTNER_SID");console.log||(window.console.log=(()=>{}));const v=(...e)=>{},b=console.log.bind(console,"asa.js");let I=v;const S=(...e)=>I(...e),$=e=>{I=e?b:v},E=b,x=e=>{let t,n,s=1,o=0;if(e)for(s=0,t=e.length-1;t>=0;t--)s=0!=(o=266338304&(s=(s<<6&268435455)+(n=e.charCodeAt(t))+(n<<14)))?s^o>>21:s;return s},R=()=>Math.round(Math.random()*Date.now());var O={getItem:e=>e&&decodeURIComponent(document.cookie.replace(new RegExp(`(?:(?:^|.*;)\\s*${encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")}\\s*\\=\\s*([^;]*).*$)|^.*$`),"$1"))||null,setItem(e,t,n,s,o,r){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;let i="";if(n)switch(n.constructor){case Number:i=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":`; max-age=${n}`;break;case String:i=`; expires=${n}`;break;case Date:i=`; expires=${n.toUTCString()}`}return document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}${i}${o?`; domain=${o}`:""}${s?`; path=${s}`:""}${r?"; secure":""}`,!0},removeItem(e,t,n){return!!this.hasItem(e)&&(document.cookie=`${encodeURIComponent(e)}=; expires=Thu, 01 Jan 1970 00:00:00 GMT${n?`; domain=${n}`:""}${t?`; path=${t}`:""}`,!0)},hasItem:e=>!(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))&&new RegExp(`(?:^|;\\s*)${encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")}\\s*\\=`).test(document.cookie),keys(){const e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);for(let t=e.length,n=0;n<t;n++)e[n]=decodeURIComponent(e[n]);return e}};let j=!1;const T=()=>{const e=(()=>`${x(h.location.host)}.${x(`${R()}`)}`)();return O.setItem("__as_user",e,1/0,"/"),j=!0,e},A=()=>{let e=O.getItem("__as_user");return(!e||e.length>70||e.length<40)&&(e=T()),e},k=()=>j,U={get(e){try{return O.getItem(e)}catch(t){throw new Error(`Error while trying to get item from session cookie:${e}`)}},set(e,t){try{return O.setItem(e,t,1/0,"/")}catch(n){throw new Error(`Error while trying to set item to session cookie: "${e}" <- ${t}`)}},remove:e=>{try{O.removeItem(e)}catch(t){throw new Error(`Error while trying to remove item from session cookie: "${e}`)}}},F={hasItem:U.get,getItem:U.get,setItem:U.set,removeItem:U.remove};let P={hasSession(){const e=F.getItem("__asa_session");try{return e&&JSON.parse(e).t>new Date}catch(e){return!1}},createSession(e){F.setItem("__asa_session",JSON.stringify(Object.assign({},e,{id:`${(()=>x(h.location.host))()}.${x(`${A()}.${R()}`)}`,t:(new Date).getTime()+18e5})))},destroySession:()=>F.removeItem("__asa_session"),getSession:()=>JSON.parse(F.getItem("__asa_session")),updateTimeout:function(e){const t=Object.assign({},this.getSession(),e,{t:(new Date).getTime()+18e5});F.setItem("__asa_session",JSON.stringify(t))}};const q=()=>P.getSession(),D=()=>!!P.hasSession(),M=e=>P.createSession(e),N=()=>P.destroySession(),C=(e,t,n)=>P=((e,t,n,s,o)=>({hasSession:e,createSession:n,getSession:t,destroySession:s,updateTimeout:o}))(e,t,n,N,J),J=e=>P.updateTimeout(e),L=e=>{if(e.hasAttribute("itemscope")){let t=Array.prototype.reduce.call(e.children,(e,t)=>Object.assign({},e,{[t.getAttribute("itemprop")]:L(t)}),{});return e.getAttribute("itemtype")&&(t={type:e.getAttribute("itemtype"),properties:t}),t}return e.hasAttribute("itemprop")?e.getAttribute("content")||e.innerText||e.src:{__items:Array.prototype.map.call(e.children,L)}},H=()=>K(Array.prototype.reduce.call(document.querySelectorAll('head > meta[property^="og:"]'),(e,t)=>Object.assign({},e,{[t.getAttribute("property")]:t.getAttribute("content")}),{keywords:document.querySelector('head > meta[name="keywords"]')&&document.querySelector('head > meta[name="keywords"]').getAttribute("content")}));let K=(e,t)=>e;const W=e=>{K=((t,n)=>{try{return e(t,n)}catch(e){return t}})},G=e=>{const t="string"==typeof e?document.querySelectorAll(e):e,n=Array.prototype.map.call(t,e=>K(L(e),e)).filter(e=>e);return n.length>1?{__items:n}:n.pop()};let z={};const B=()=>{const e=[];for(const t in z)z.hasOwnProperty(t)&&z[t]&&e.push(t);return e.join(".")},Y=1,Q=1,V=77,X=()=>[Y,Q,V].join(".")+(B()?`-${B()}`:""),Z=e=>!(!e||!(e instanceof HTMLElement||e[0]instanceof HTMLElement||"string"==typeof e))&&e;var ee;!function(e){let t,n,s,o;!function(e){e["session.started"]="session.started",e["session.resumed"]="session.resumed",e["as.web.customer.account.provided"]="as.web.customer.account.provided",e["as.web.order.reviewed"]="as.web.order.reviewed",e["as.web.product.availability.checked"]="as.web.product.availability.checked",e["as.web.product.carted"]="as.web.product.carted",e["as.web.product.searched"]="as.web.product.searched",e["as.web.product.shipping.selected"]="as.web.product.shipping.selected",e["as.web.product.viewed"]="as.web.product.viewed",e["as.web.payment.completed"]="as.web.payment.completed",e["page.viewed"]="page.viewed",e.custom="custom"}(t=e.Type||(e.Type={}));class r{constructor(e){const{id:t,referrer:n,campaign:s}=q(),o=w(),r=_();this.origin=h.location.origin,this.occurred=new Date,s&&(this.campaign=s),this.user={did:A(),sid:t},this.page={url:h.location.href},n&&(this.page.referrer=n),h.asa.id&&(this.tenant_id=h.asa.id),o&&(this.partner_id=o),r&&(this.partner_sid=r),this.v=X(),Object.assign(this,e)}toJSON(){return JSON.parse(JSON.stringify(Object.assign({},this)))}[Symbol.toPrimitive](){return this.type}}e.Event=r,function(e){e.viewed=class extends r{constructor(...e){if(super(),this.type=t["page.viewed"],this.location=h.location.href,this.title=document.title,Z(e[0])){const t=G(e[0]);t&&(this.meta=t),e[1]&&(this.meta=Object.assign({},this.meta,e[1]))}else e[0]?this.meta=Object.assign({},this.meta,e[0],H()):this.meta=H()}}}(n=e.page||(e.page={})),function(e){e.started=class extends n.viewed{constructor(){super(...arguments),this.type=t["session.started"],this.meta=Object.assign({},this.meta,H())}};e.resumed=class extends r{constructor(){super(...arguments),this.type=t["session.resumed"],this.meta=Object.assign({},this.meta,H())}}}(s=e.session||(e.session={})),function(e){let n;!function(e){let n,s,o;!function(e){e.reviewed=class extends r{constructor(){super(...arguments),this.type=t["as.web.order.reviewed"]}}}(n=e.order||(e.order={})),function(e){let n,s;!function(e){e.checked=class extends r{constructor(){super(...arguments),this.type=t["as.web.product.availability.checked"]}}}(n=e.availability||(e.availability={}));e.carted=class extends r{constructor(){super(...arguments),this.type=t["as.web.product.carted"]}};e.searched=class extends r{constructor(){super(...arguments),this.type=t["as.web.product.searched"]}},function(e){e.selected=class extends r{constructor(){super(...arguments),this.type=t["as.web.product.shipping.selected"]}}}(s=e.shipping||(e.shipping={}));e.viewed=class extends r{constructor(){super(...arguments),this.type=t["as.web.product.viewed"]}}}(s=e.product||(e.product={})),function(e){e.completed=class extends r{constructor(){super(...arguments),this.type=t["as.web.payment.completed"]}}}(o=e.payment||(e.payment={}))}(n=e.web||(e.web={}))}(o=e.as||(e.as={})),e.custom=(e=>(class extends r{constructor(...n){if(super(),this.type=t.custom,this.event=e,Z(n[0])){const e=G(n[0]);e&&(this.meta=e),n[1]&&(this.meta=Object.assign({},this.meta,n[1]))}else n[0]&&(this.meta=Object.assign({},this.meta,n[0]))}}))}(ee||(ee={}));const te=(e,t)=>fetch(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"text/plain; charset=UTF-8"}}),ne=e=>(e=>te("//inbox.activitystream.com/asa",e))({ev:e,t:(e=>{const t=e=>e<10?`0${e}`:e;return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}T${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}.${(e.getMilliseconds()/1e3).toFixed(3).slice(2,5)}${(e=>{const n=t(Math.abs(Math.floor(e/60))),s=t(Math.abs(e%60));return`${(e>0?"-":"+")+n}:${s}`})(e.getTimezoneOffset())}`})(new Date)}),se=(e,t)=>e&&(22===e.code||18===e.code)||(e=>te("//inbox.activitystream.com/asa/error",e))({err:e,context:t,v:X()});var oe=new class{constructor(){this._dispatchEvent=ne,this._dispatchError=se,this.pendingSubmission=[],this.done=!0}batchEvent(e){this.pendingSubmission.push(e)}get submitEvent(){return this._dispatchEvent}get submitError(){return this._dispatchError}batchOn(){this.batchIntervalHandler=setInterval(()=>{try{if(this.pendingSubmission.length>0&&this.done){const e=Math.min(this.pendingSubmission.length,10),t=this.pendingSubmission.slice(0,e);this.done=!1,ne(t).then(()=>this.pendingSubmission.splice(0,t.length)).catch(S)}}catch(e){S("exception submitting",e)}},400)}batchOff(){this.batchIntervalHandler?clearInterval(this.batchIntervalHandler):S("cannot batch off, it is not on")}override(e=this._dispatchEvent,t=this._dispatchError){this._dispatchError=t,this._dispatchEvent=e}reset(){this._dispatchError=se,this._dispatchEvent=ne}},re=(e,t,n)=>{if(t&&t.length>0){const s=p.parseURI(t).authority;if(s!=p.parseURI(e).authority&&-1===n.indexOf(s))return t}return null};function ie(e){let t=[];y();const n={"custom.session.created":(e,...t)=>C(e,t[0],t[1]),"connected.partners.provided":e=>(function(e){const t=e,n=({target:e})=>{let n=e.href;if(n){const s=p.parseURI(n);if(t.indexOf(s.authority)>-1){if(!s.queryKey.__asa){const t=-1!==e.href.indexOf("?");n=`${n+(t?"&":"?")}__asa=${encodeURIComponent(`${h.asa.id}|${q().id}`)}`,e.href=n}const t={};if(["utm_medium","utm_source","utm_campaign","utm_content","utm_term"].forEach(e=>{const n=h.sessionStorage.getItem(`__as.${e}`);n&&(t[e]=n)}),Object.keys(t).length&&!Object.keys(s.queryKey).some(e=>-1!==e.indexOf("utm_"))){const s=-1!==n.indexOf("?");Object.keys(t).forEach((e,o)=>{n=`${n+(s||0!==o?"&":"?")+e}=${encodeURIComponent(t[e])}`}),e.href=n}}}};document.addEventListener("mousedown",n),document.addEventListener("keyup",n),document.addEventListener("touchstart",n)})(e),"service.providers.provided":e=>{t=e},"tenant.id.provided":e=>{h.asa.id=e},"debug.mode.enabled":e=>$(e),"microdata.transformer.provided":e=>W(e)},s=function(e,o,...r){try{if("string"==typeof e&&e in n)return void n[e](o,...r);const i=g(),a=re(l.location,l.referrer,t);if(D()){const e=p.parseURI(l.referrer).authority;e!==p.parseURI(l.location).authority&&-1===t.indexOf(e)&&(J({campaign:i,referrer:a}),S("session resumed"),s.transport(new ee.session.resumed))}else S("no session, starting a new one"),M({campaign:i,referrer:a}),s.transport(new ee.session.started({newBrowser:k()}));s.transport(new e(o,...r))}catch(t){E("inbox exception:",t),oe.submitError(t,{location:"processing inbox message",arguments:[e,o,...r]})}return s};return s.id=e,s.transport=(e=>(oe.submitEvent(e),s)),s}((e=[])=>{try{const t=window.asa&&window.asa.q||[];window.asa=new ie,window.WebEvent=ee,y(),(e=>{(e=e||[])instanceof Array||(e=[e]);for(let t=0;t<e.length;t++)window.asa.apply(null,e[t])})(e);for(let e=0;e<t.length;e++)window.asa.apply(null,t[e])}catch(e){E("exception during init: ",e),oe.submitError(e,{location:"boot script"})}})()});
